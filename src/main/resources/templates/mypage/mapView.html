<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>지도에서 찜한 매물 보기</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; background: #f5f5f5; margin: 0; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; background: #fff; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .header h2 { margin: 0; }
        .sort-box { display: flex; align-items: center; gap: 10px; }
        select { padding: 6px; font-size: 14px; }
        .item { display: flex; gap: 12px; margin-bottom: 16px; border-bottom: 1px solid #eee; padding-bottom: 12px; }
        .item img { width: 100px; height: 80px; border-radius: 8px; object-fit: cover; }
        .info { flex: 1; }
        .title { font-weight: bold; margin-bottom: 4px; }
        .addr { color: #666; font-size: 13px; }
        .meta { font-size: 12px; margin-top: 4px; color: #999; }
        .heart { color: #007aff; font-size: 20px; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h2>지도에서 보기</h2>
        <div class="sort-box">
            <label for="sort">정렬:</label>
            <select id="sort">
                <option value="recent">최근 찜한 순</option>
                <option value="price_asc">가격 낮은 순</option>
                <option value="price_desc">가격 높은 순</option>
                <option value="area_asc">면적 작은 순</option>
                <option value="area_desc">면적 큰 순</option>
            </select>
        </div>
    </div>

    <div id="map-liked-list"></div>
</div>

<script>
    let mapPage = 0;
    let hasMoreMap = true;

    document.getElementById("sort").addEventListener("change", () => {
        mapPage = 0;
        hasMoreMap = true;
        document.getElementById("map-liked-list").innerHTML = "";
        loadMapLikedProperties();
    });

    async function loadMapLikedProperties() {
        if (!hasMoreMap) return;

        const sort = document.getElementById("sort").value;

        try {
            const response = await fetch(`/mypage/histories/bookmarked-properties/map?page=${mapPage}&size=20&sort=${sort}`, {
                headers: {
                    "x-access-token": localStorage.getItem("token")
                }
            });
            const data = await response.json();
            const items = data.bookmarkedProperties;

            if (!items || items.length === 0) {
                hasMoreMap = false;
                return;
            }

            const listDiv = document.getElementById("map-liked-list");
            items.forEach(item => {
                const el = document.createElement("div");
                el.className = "item";
                el.innerHTML = `
                    <img src="${item.thumbnailImage}" alt="매물 이미지" />
                    <div class="info">
                        <div class="title">${item.tradeTypeName} ${item.dealOrWarrantPrc}</div>
                        <div class="addr">${item.articleName} ${item.buildingName}</div>
                        <div class="meta">${item.realestateTypeName} · ${item.area1}㎡</div>
                    </div>
                    <div class="heart">${item.isBookmarked ? "💙" : "💕"}</div>
                `;
                listDiv.appendChild(el);
            });

            hasMoreMap = data.hasNext;
            mapPage += 1;
        } catch (e) {
            console.error("지도 매물 조회 실패", e);
        }
    }

    window.addEventListener("scroll", () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
            loadMapLikedProperties();
        }
    });

    loadMapLikedProperties();
</script>
</body>
</html>
