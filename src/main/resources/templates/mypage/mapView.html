<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ì§€ë„ì—ì„œ ì°œí•œ ë§¤ë¬¼ ë³´ê¸°</title>
    <style>
        body { font-family: 'Pretendard', sans-serif; background: #f5f5f5; margin: 0; }
        .container { max-width: 800px; margin: 0 auto; padding: 20px; background: #fff; }
        .header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .header h2 { margin: 0; }
        .sort-box { display: flex; align-items: center; gap: 10px; }
        select { padding: 6px; font-size: 14px; }
        .item { display: flex; gap: 12px; margin-bottom: 16px; border-bottom: 1px solid #eee; padding-bottom: 12px; }
        .item img { width: 100px; height: 80px; border-radius: 8px; object-fit: cover; }
        .info { flex: 1; }
        .title { font-weight: bold; margin-bottom: 4px; }
        .addr { color: #666; font-size: 13px; }
        .meta { font-size: 12px; margin-top: 4px; color: #999; }
        .heart { color: #007aff; font-size: 20px; }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <h2>ì§€ë„ì—ì„œ ë³´ê¸°</h2>
        <div class="sort-box">
            <label for="sort">ì •ë ¬:</label>
            <select id="sort">
                <option value="recent">ìµœê·¼ ì°œí•œ ìˆœ</option>
                <option value="price_asc">ê°€ê²© ë‚®ì€ ìˆœ</option>
                <option value="price_desc">ê°€ê²© ë†’ì€ ìˆœ</option>
                <option value="area_asc">ë©´ì  ì‘ì€ ìˆœ</option>
                <option value="area_desc">ë©´ì  í° ìˆœ</option>
            </select>
        </div>
    </div>

    <div id="map-liked-list"></div>
</div>

<script>
    let mapPage = 0;
    let hasMoreMap = true;

    document.getElementById("sort").addEventListener("change", () => {
        mapPage = 0;
        hasMoreMap = true;
        document.getElementById("map-liked-list").innerHTML = "";
        loadMapLikedProperties();
    });

    async function loadMapLikedProperties() {
        if (!hasMoreMap) return;

        const sort = document.getElementById("sort").value;

        try {
            const response = await fetch(`/mypage/histories/bookmarked-properties/map?page=${mapPage}&size=20&sort=${sort}`, {
                headers: {
                    "x-access-token": localStorage.getItem("token")
                }
            });
            const data = await response.json();
            const items = data.bookmarkedProperties;

            if (!items || items.length === 0) {
                hasMoreMap = false;
                return;
            }

            const listDiv = document.getElementById("map-liked-list");
            items.forEach(item => {
                const el = document.createElement("div");
                el.className = "item";
                el.innerHTML = `
                    <img src="${item.thumbnailImage}" alt="ë§¤ë¬¼ ì´ë¯¸ì§€" />
                    <div class="info">
                        <div class="title">${item.tradeTypeName} ${item.dealOrWarrantPrc}</div>
                        <div class="addr">${item.articleName} ${item.buildingName}</div>
                        <div class="meta">${item.realestateTypeName} Â· ${item.area1}ã¡</div>
                    </div>
                    <div class="heart">${item.isBookmarked ? "ğŸ’™" : "ğŸ’•"}</div>
                `;
                listDiv.appendChild(el);
            });

            hasMoreMap = data.hasNext;
            mapPage += 1;
        } catch (e) {
            console.error("ì§€ë„ ë§¤ë¬¼ ì¡°íšŒ ì‹¤íŒ¨", e);
        }
    }

    window.addEventListener("scroll", () => {
        if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 100) {
            loadMapLikedProperties();
        }
    });

    loadMapLikedProperties();
</script>
</body>
</html>
