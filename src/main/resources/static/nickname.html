<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>닉네임 수정</title>
    <style>
        body { font-family: sans-serif; margin: 2rem; }
        input, button { margin: 1rem 0; display: block; }
        #message { color: red; }
    </style>
</head>
<body>
<h1>닉네임 수정</h1>

<input id="nickname" placeholder="새 닉네임 입력" />
<button id="update-btn">닉네임 저장</button>

<p id="message"></p>

<script>
    document.getElementById('update-btn').onclick = async () => {
        const nickname = document.getElementById('nickname').value.trim();
        const messageEl = document.getElementById('message');
        messageEl.innerText = '';

        if (!nickname) {
            messageEl.innerText = '닉네임을 입력해주세요.';
            return;
        }

        try {
            const res = await fetch('http://localhost:8080/users/auth/register', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                credentials: 'include', // ← 쿠키 기반 인증 시 필수!
                body: JSON.stringify({ nickname })
            });

            if (res.ok) {
                // 본문이 있을 경우만 JSON 파싱
                const contentLength = res.headers.get('content-length');
                if (contentLength && parseInt(contentLength) > 0) {
                    const data = await res.json(); // optional
                    console.log('서버 응답:', data);
                }

                alert('닉네임이 성공적으로 변경되었습니다.');
                window.location.href = 'http://localhost:8080/home.html';
            } else {
                const errorText = await res.text();
                messageEl.innerText = errorText || '닉네임 변경 실패';
            }
        } catch (e) {
            console.error('클라이언트 오류:', e);
            messageEl.innerText = '서버 오류가 발생했습니다.';
        }
    };
</script>
</body>
</html>
