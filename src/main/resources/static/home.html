<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8" />
    <title>홈</title>
    <style>
        body { font-family: sans-serif; margin: 2rem; }
        .token { word-break: break-all; background: #eee; padding: 0.5rem; margin-bottom: 1rem; }
        button { margin: 1rem 0; }
    </style>
</head>
<body>
<h1>홈</h1>

<h3>액세스 토큰</h3>
<div class="token" id="access-token"></div>

<h3>리프레시 토큰</h3>
<div class="token" id="refresh-token"></div>

<button id="refresh-btn">액세스 토큰 재발급</button>
<button id="logout-btn">로그아웃</button>

<script>
    const accessTokenDiv = document.getElementById('access-token');
    const refreshTokenDiv = document.getElementById('refresh-token');

    // 화면에 출력
    function renderTokens() {
        accessTokenDiv.textContent = localStorage.getItem('accessToken') || '';
        refreshTokenDiv.textContent = localStorage.getItem('refreshToken') || '';
    }

    // 처음 페이지 로드될 때 URL 파라미터에서 토큰들 localStorage에 저장
    window.onload = () => {
        const urlParams = new URLSearchParams(window.location.search);
        const accessToken = urlParams.get('accessToken');
        const refreshToken = urlParams.get('refreshToken');

        if (accessToken && refreshToken) {
            localStorage.setItem('accessToken', accessToken);
            localStorage.setItem('refreshToken', refreshToken);
        }

        renderTokens();
    };

    // 액세스 토큰 재발급
    document.getElementById('refresh-btn').onclick = async () => {
        const refresh = localStorage.getItem('refreshToken');
        if (!refresh) return alert('리프레시 토큰 없음');

        const res = await fetch('/users/auth/refresh', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ refreshToken: refresh })
        });

        if (res.status === 200) {
            const data = await res.json();
            localStorage.setItem('accessToken', data.accessToken);
            renderTokens();
            alert('새로운 액세스 토큰 발급 완료');
        } else {
            alert('리프레시 만료! 다시 로그인 필요');
            localStorage.clear();
            window.location.href = '/login.html';
        }
    };

    // 로그아웃
    document.getElementById('logout-btn').onclick = async () => {
        const kakaoAccess = localStorage.getItem('accessToken');
        if (!kakaoAccess) return alert('먼저 로그인하세요');

        const res = await fetch('/users/auth/logout', {
            method: 'POST',
            headers: {
                'Kakao-Access': kakaoAccess,
                'Authorization': 'Bearer ' + kakaoAccess
            }
        });

        if (res.status === 204) {
            alert('로그아웃 완료');
            localStorage.clear();
            window.location.href = '/login.html';
        } else {
            alert('로그아웃 실패');
        }
    };
</script>
</body>
</html>
